---
nest::cflags: '-march=haswell -O2 -pipe -ggdb'
nest::cpu_flags_x86: 'aes avx avx2 fma3 mmx mmxext popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3'
nest::use: ['numa']

nest::package_use:
  # For Dracut liveimg module
  net-misc/iputils:
    use: 'arping'

nest::kernel_config:
  # Architecture options
  CONFIG_NUMA_BALANCING: y
  CONFIG_X86_X2APIC: y
  CONFIG_MCORE2: y
  CONFIG_GENERIC_CPU: n
  CONFIG_TRANSPARENT_HUGEPAGE: y
  CONFIG_INTEL_IDLE: y

  # Virtualization
  CONFIG_NO_HZ_IDLE: n
  CONFIG_NO_HZ_FULL: y
  CONFIG_KVM: m
  CONFIG_KVM_INTEL: m
  CONFIG_PCI_STUB: y
  CONFIG_VFIO: m
  CONFIG_VFIO_PCI: m

  # Framebuffers
  CONFIG_X86_SYSFB: y
  CONFIG_FB_SIMPLE: y

  # Device drivers
  CONFIG_IGB: m
  CONFIG_IPMI_HANDLER: m
  CONFIG_IPMI_DEVICE_INTERFACE: m
  CONFIG_IPMI_SI: m
  CONFIG_I2C_CHARDEV: m
  CONFIG_SND_HDA_INTEL: m
  CONFIG_SND_HDA_CODEC_REALTEK: m
  CONFIG_SND_HDA_CODEC_HDMI: m
  CONFIG_SND_HDA_PREALLOC_SIZE: 2048

  # For docker
  CONFIG_CGROUP_HUGETLB: y

# Support new multilib layout in Gentoo 17.1 profile
apache::lib_path: '/usr/lib64/apache2/modules'
